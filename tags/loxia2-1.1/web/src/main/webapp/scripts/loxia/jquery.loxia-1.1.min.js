(function(a){var c=this;if(typeof this["loxia"]=="undefined"){this.loxia={SUCCESS:"success",ERROR:"error",debug:false,region:"",dateFormat:"yy-mm-dd",pageLock:true,windowFeatures:"toolbar=no, menubar=no,scrollbars=yes, resizable=no,location=no, status=no",onionPage:undefined,getViewport:function(){var d,e;if(typeof window.innerWidth!="undefined"){d=window.innerWidth,e=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){d=document.documentElement.clientWidth,e=document.documentElement.clientHeight}else{d=document.getElementsByTagName("body")[0].clientWidth,e=document.getElementsByTagName("body")[0].clientHeight}}return{width:d,height:e}},isString:function(d){return typeof d=="string"||d instanceof String},getTimeUrl:function(d){var e=(new Date()).getTime();if(d.indexOf("loxiaflag=")>=0){d=d.replace(/loxiaflag=\d{13}/,"loxiaflag="+e.toString());return d}d+=(/\?/.test(d))?"&":"?";return(d+"loxiaflag="+e.toString())},encodeUrl:function(f){var e=f.indexOf("?");if(e==-1){return f}var d=f.substring(0,e+1);var j=f.substring(e+1).split("&");for(var g=0;g<j.length;g++){if(g>0){d+="&"}var h=j[g].split("=");d+=h[0]+"="+encodeURIComponent(h[1])}return d},upperFirstLetter:function(d){return d.substring(0,1).toUpperCase()+d.substring(1)},getLocaleMsg:function(j,f){var d=this.regional[this.region][j];if(d==undefined||d==null){d=this.regional[this.region][""]}if(d==undefined||d==null){return j}if(!f){return d}if(!a.isArray(f)){f=[f]}var h=d.match(/\{\d+\}/ig);if(!h||h.length==0){return d}d=d.replace(/\{\d+\}/ig,"#");for(var g=0;g<h.length;g++){var e=parseInt(h[g].replace(/\{/,"").replace(/\}/,""));d=d.replace(/\#/,(f[e]!=undefined&&f[e]!=null)?""+f[e]:"")}return d},getObject:function(g,f){f=f||c;var h=g.split(".");for(var e=0,d;f&&(d=h[e]);e++){f=(d in f?f[d]:undefined)}return f},setObject:function(h,g,f){f=f||c;var k=h.split(".");var j=k.pop();for(var e=0,d;f&&(d=k[e]);e++){f=(d in f?f[d]:f[d]={})}return(f&&j?(f[j]=g):undefined)},hitch:function(d,e){if(!e){e=d;d=null}if(this.isString(e)){d=d||c;if(!d[e]){throw (['hitch: scope["',e,'"] is null (scope="',d,'")'].join(""))}return function(){return d[e].apply(d,arguments||[])}}return !d?e:function(){return e.apply(d,arguments||[])}},_setValue:function(f,d,e){if(e==null){return}var g=f[d];if(this.isString(g)){f[d]=[g,e]}else{if(a.isArray(g)){f[d].push(e)}else{f[d]=e}}},_fieldValue:function(f){var d=null,e=(f.type||"").toLowerCase();if(f.name&&e&&!f.disabled){if(e=="radio"||e=="checkbox"){if(f.checked){d=f.value}}else{if(f.multiple){d=[];a("option",f).each(function(){if(this.selected){d.push(this.value)}})}else{d=f.value}}}return d},_formToObj:function(f){if(!f){return{}}f=this.isString(f)?a("#"+f).get(0):f;var e={},d="file|submit|image|reset|button|",g=this;a(f.elements).each(function(){var h=this.name;var i=(this.type||"").toLowerCase();if(h&&i&&d.indexOf(i)==-1&&!this.disabled){g._setValue(e,h,g._fieldValue(this))}});return e},asyncXhr:function(f,e,g){var d={};if(arguments.length==1){d=f}else{d=e;d.url=f;if(g){d.success=g}}d.dataType=d.dataType||"json";d.data=a.extend({},d.data,this._formToObj(d.form));a.ajax(d)},asyncXhrGet:function(e,d,f){if(d){d.type="GET"}else{e.type="GET"}this.asyncXhr(e,d,f)},asyncXhrPost:function(e,d,f){if(d){d.type="POST"}else{e.type="POST"}this.asyncXhr(e,d,f)},syncXhr:function(f,e){var g;var d={async:false,success:function(h,i){g=h},error:function(i,k,j){g={};var h={};h.message="Error occurs when fetching data from url:"+this.url;h.cause=k?k:j;g.exception=h}};if(e){a.extend(e,d)}else{a.extend(f,d)}this.asyncXhr(f,e);return g},syncXhrGet:function(e,d){if(d){d.type="GET"}else{e.type="GET"}return this.syncXhr(e,d)},syncXhrPost:function(e,d){if(d){d.type="POST"}else{e.type="POST"}return this.syncXhr(e,d)},isLoxiaWidget:function(d){return a(d).hasClass("loxia")},init:function(d){a.extend(this,d);if(this.pageLock){if(this.onionPage){a(document).find("body").loxiaonionpage({layer:this.onionPage})}else{a(document).find("body").loxiaonionpage()}}this.initContext()},initContext:function(d){if(d==undefined){d=document}if(a(d).attr("loxiaType")){this.initLoxiaWidget(d)}else{a(d).find("> table[loxiaType]").each(function(){loxia.initLoxiaWidget(this)});a(d).find("[loxiaType]").each(function(){loxia.initLoxiaWidget(this)})}},initLoxiaWidget:function(f){var g;switch(a(f).attr("loxiaType")){case"button":a(f).loxiabutton();break;case"input":a(f).loxiainput();break;case"number":a(f).loxianumber();break;case"date":a(f).loxiadate();break;case"select":a(f).loxiaselect();break;case"dropdown":var h=a(f).attr("data"),d=a(f).attr("choice"),e=a(f).attr("editable"),i=a(f).attr("findMode"),g={};if(h){g.data=h}if(e=="true"||e==true){g.editable=e}if(d){g.choice=d}if(i){g.findMode=i}a(f).loxiadropdown(g);break;case"table":g=a(f).attr("settings");g=g?c[g]:{};a(f).loxiatable(a.extend({},g));break;case"edittable":g=a(f).attr("settings");g=g?c[g]:{};a(f).loxiaedittable(a.extend({},g));break;case"dialog":g=a(f).attr("settings");g=g?c[g]:{};a(f).loxiadialog(a.extend({},g))}},openPage:function(d,g,f,e){g=g||"_blank";f=f||this.windowFeatures;if(e&&e.length&&e.length==2){f="width="+e[0]+",height="+e[1]+","+f}return window.open(d,g,f)},lockPage:function(){if(this.pageLock){var d=a(document).find("body").data("loxiaonionpage");d.show()}},unlockPage:function(){if(this.pageLock){var d=a(document).find("body").data("loxiaonionpage");d.hide()}},val:function(g,f){if(g==undefined){return null}if(this.isLoxiaWidget(g)){var d=a(g).data("baseClass");if(d){if(f){a(g).data(d).val(f)}else{return a(g).data(d).val()}}}if(a(g).is("input,select,textarea")){if(f){a(g).val(f)}else{return a(g).val()}}var e=a(g).find("input,select,textarea").get(0);if(e){if(this.isLoxiaWidget(e)){var d=a(e).data("baseClass");if(d){if(f){a(e).data(d).val(f)}else{return a(e).data(d).val()}}else{return null}}else{if(f){a(e).val(f)}else{return a(e).val()}}}else{if(f){a(g).text(f)}else{return a(g).text()}}},validateForm:function(h){h=this.isString(h)?a("#"+h).get(0):h;var g=[],j=0;a("input.loxia:enabled,select.loxia:enabled,textarea.loxia:enabled").each(function(){if(a(this).attr("formCheck")=="false"||a(this).attr("formCheck")==false){return}if(a(this).data("baseClass")){var i=a(this).data("baseClass");if(a(this).data(i).getState()==null){a(this).data(i).check()}if(!a(this).data(i).getState()){j++}}});if(j>0){g.push(this.getLocaleMsg("VALIDATE_FIELD_ERROR",[j]));return g}var f=a(h).attr("validate");if(!f){f=a(h).attr("name")+"Validate"}if(c[f]&&a.isFunction(c[f])){var d=this.hitch(c[f])(h);if(d!=this.SUCCESS){g.push(this.getLocaleMsg("VALIDATE_FORM_ERROR"));if(a.loxia.isString(d)){g.push(d)}else{for(var e=0;e<d.length;e++){g.push(d[e])}}}}return g},submitForm:function(e){e=this.isString(e)?a("#"+e).get(0):e;var d=this.validateForm(e);if(d.length==0){e.submit()}else{a("body").trigger("formvalidatefailed",[[d,e]])}},log:function(d){if(!this.debug){return}if(c.console){c.console.log(d)}else{alert(d.outerHTML?"Dom Object: "+d.outerHTML:d)}}};loxia.regional=[];loxia.regional[""]={INVALID_EMPTY_DATA:"Current Input is a mandatory one",INVALID_DATA:"Current Input is invalid",INVALID_NUMBER:"Invalid Number",INVALID_DATE:"Invalid Date",DATA_EXCEED_RANGE:"Input data exceeds range",VALIDATE_FIELD_ERROR:"{0} field error(s) found.",VALIDATE_FORM_ERROR:"Form validation failed:",TABLE_PER_PAGE:"Per Page",TABLE_PAGER_FIRST:"First Page",TABLE_PAGER_PREVIOUS:"Previous Page",TABLE_PAGER_NEXT:"Next Page",TABLE_PAGER_LAST:"Last Page",TABLE_PAGER_GOTO:"Goto Page",TABLE_PAGER_RELOAD:"Reload",TABLE_PAGE:"Page",TABLE_PAGE_INFO:"{0} item(s)",TABLE_PAGE_ERROR_OCCURS:"Error occurs at reloading.",TABLE_PAGE_RELOAD:"Table is refreshed.",TABLE_BARBTN_ADD:"Add New Line",TABLE_BARBTN_DELETE:"Delete Selected Lines"};loxia.defaults={baseClass:"",required:false,lastRightValue:undefined,checkmaster:"",state:null,errorMessage:null};loxia.loxiaWidget={_setValue:function(d){return this.element.val(d)},_getValue:function(){return this.element.val()},val:function(e){if(e!=undefined){this._setValue(e);var d=this.check();return this.element}else{return this._getData("lastRightValue")}},setReadonly:function(d){if(d){this.element.attr("readonly","readonly")}else{this.element.removeAttr("readonly")}},setEnable:function(d){if(d){this.element.removeClass("ui-state-disabled");this.element.removeAttr("disabled")}else{this.element.addClass("ui-state-disabled");this.element.attr("disabled","disabled")}},clearState:function(){this._setData("state",null);this._setData("errorMessage",null);this.element.removeClass("ui-state-error")},getState:function(){return this.options.state},setState:function(d,e){this.clearState();this._setData("state",(d==true));if(!this._getData("state")){this.element.addClass("ui-state-error");this._setData("errorMessage",e)}},check:function(){this.clearState();var j=this._getValue();if(this._getData("required")&&j==""){this.setState(false,loxia.getLocaleMsg("INVALID_EMPTY_DATA"));return false}if(j==this.val()){this.setState(true);return true}if(this._getData("checkmaster")){var f=this._getData("checkmaster").split(",");var h={};for(var e,g=0;e=f[g];g++){if(e in h){continue}h[e]=e;var d=loxia.hitch(e)(j,this);if(d.indexOf(loxia.SUCCESS)!=0){this.setState(false,d);return false}if(d.length>8){j=d.substring(8);this._setValue(j)}}}this.setState(true);this._setData("lastRightValue",j);this.element.trigger("valuechanged",[j]);return true}};loxia.loxiaGetter="val check getState getBaseClass"}checkNumber=function(j,k){var j=a.trim(j);if(!j){return loxia.SUCCESS}var i=j.charAt(0);if(i=="+"||i=="-"){j=j.substring(1)}else{i=""}j=j.replace(/^(0(?=\d))+/,"");var e=k._getData("decimal");var h=new RegExp("^\\d+$");if(e){h=new RegExp("^\\d+\\.?\\d{0,"+e+"}$")}else{e=0}if(!h.test(j)){return loxia.getLocaleMsg("INVALID_NUMBER")}j=j.replace(/^\./,"0.");j=j.replace(/\.$/,".0");j=i+j;var f=parseFloat(j),g=k._getData("min"),d=k._getData("max");if((g&&f<g)||(d&&f>d)){return loxia.getLocaleMsg("DATA_EXCEED_RANGE")}return loxia.SUCCESS+"^"+f.toFixed(e)};checkDate=function(f,i){try{var h=a.datepicker.parseDate(loxia.dateFormat,f),d=i._getData("min"),j=i._getData("max");if((d&&h<d)||(j&&h>j)){return loxia.getLocaleMsg("DATA_EXCEED_RANGE")}}catch(g){return loxia.getLocaleMsg("INVALID_DATE")}return loxia.SUCCESS};var b={_init:function(){if(this.options.layer){if(loxia.isString(this.options.layer)){this.options.layer=a("#"+this.options.layer).get(0)}}else{a(document).find("body").append(a.loxiaonionpage.onDiv);this.options.layer=a(".loxia-onion-container").get(0)}a(this.options.layer).hide()},show:function(){var d=a(".loxia-onion",this.options.layer);d.css({width:a(window).width()+"px",height:a(document).height()+"px"});a(this.options.layer).show()},hide:function(){a(this.options.layer).hide()}};a.widget("ui.loxiaonionpage",b);a.ui.loxiaonionpage.getter="";a.ui.loxiaonionpage.defaults={layer:undefined};a.loxiaonionpage={onDiv:'<div class="loxia loxia-onion-container"><div class="loxia-onion ui-widget-overlay position:absolute;"></div></div>'}})(jQuery);(function(b){var a={_init:function(){if(!b.loxiatooltip.initialized){b(document).find("body").append(b.loxiatooltip.tpDiv);b.loxiatooltip.initialized=true;b(".loxia-tooltip").hide()}},_tipSide:"",_prepare:function(f){this._tipSide="right";b.loxiatooltip.setMessage(f,b(".loxia-tooltip").get(0));var d=loxia.getViewport(),j=this.element.offset();var i=j.left+this.element.width(),h=j.top,e=b(".loxia-tooltip").width(),c=b(".loxia-tooltip").height();if(this.options.onShow){loxia.hitch(this,this.options.onShow)({target:this.element[0]})}if(d.width-i<=e+8){this._tipSide="left";i=j.left-e}if(this._tipSide=="left"&&j.left<e+8){i=j.left;if(this.element.data("dropdown")){this._tipSide="up";h-=c}else{this._tipSide="down";h+=c}}b(".loxia-tooltip").css({position:"absolute",top:h+"px",left:i+"px",opacity:0});var g=b(".loxia-tooltip .ui-tooltip-arrow");g.removeClass("ui-tooltip-arrow-left ui-tooltip-arrow-right ui-tooltip-arrow-up ui-tooltip-arrow-down");if(this._tipSide=="right"){i+=8;g.addClass("ui-tooltip-arrow-left")}else{if(this._tipSide=="left"){i-=8;g.addClass("ui-tooltip-arrow-right")}else{if(this._tipSide=="down"){h+=8;g.addClass("ui-tooltip-arrow-up")}else{h-=8;g.addClass("ui-tooltip-arrow-down")}}}},show:function(c){this._prepare(c);b(".loxia-tooltip").show();var f=b(".loxia-tooltip").offset();var e=f.left,d=f.top;if(this._tipSide=="right"){e+=8}else{if(this._tipSide=="left"){e-=8}else{if(this._tipSide=="down"){d+=8}else{d-=8}}}b(".loxia-tooltip").animate({opacity:1,left:e,top:d},"fast")},hide:function(){b(".loxia-tooltip").hide();if(this.options.onHide){loxia.hitch(this,this.options.onHide)({target:this.element[0]})}}};b.widget("ui.loxiatooltip",a);b.ui.loxiatooltip.getter="";b.ui.loxiatooltip.defaults={onShow:undefined,onHide:undefined};b.loxiatooltip={tpDiv:'<div class="loxia loxia-tooltip ui-widget"><div class="ui-tooltip-arrow"></div><div class="ui-state-highlight ui-corner-all"  style="padding: .3em .7em; width: auto;"></div></div>',initialized:false,setMessage:function(c,d){b(d).find(".ui-state-highlight").text(c)}}})(jQuery);(function(a){var b={_init:function(){if(this.element.is("input[type='button']")||this.element.is("button")){this.element.removeAttr("loxiaType");this.options.type=this.element.attr("buttonType")||this.options.type;this.element.addClass("loxia loxia-button ui-state-default ui-corner-all");if(this.element.attr("disabled")){this.setEnable(false)}this.element.bind("click",function(i){i.stopPropagation();var g=a(this).data("loxiabutton");switch(g.options.type){case"submit":loxia.lockPage();loxia.submitForm(a(this).parents("form").get(0));break;case"anchor":var f=a(this).attr("href"),h=a(this).attr("target");if(h=="_blank"){loxia.openPage(loxia.getTimeUrl(loxia.encodeUrl(f)))}else{loxia.lockPage();window.location=loxia.getTimeUrl(loxia.encodeUrl(f))}break;case"pop":var f=a(this).attr("href"),j="";for(k in this.options.data){j+="&"+k+"="+this.options.data[k]}f+=(/\?/.test(f)?"&":"?")+j.substring(1);var d=null;if(a(this).attr("popfor")){d=a(this).prev(a(this).attr("popfor"))}else{d=a(this).prev()}var c=loxia.openPage(f);if(!c.opener){c.opener=self}c.dialogTarget=d;break;case"close":if(a.browser.msie){window.top.close()}else{window.close()}break}});this.element.hover(function(){if(a(this).is(".ui-state-disabled")){return}a(this).toggleClass("ui-state-hover")},function(){if(a(this).is(".ui-state-disabled")){return}a(this).toggleClass("ui-state-hover")}).focus(function(){a(this).addClass("ui-state-focus")}).blur(function(){a(this).removeClass("ui-state-focus")})}else{throw new exception("Wrong DOM Type for Button.")}},setEnable:function(c){if(c){this.element.removeClass("ui-state-disabled");this.element.removeAttr("disabled")}else{this.element.addClass("ui-state-disabled");this.element.attr("disabled","disabled")}}};a.widget("ui.loxiabutton",b);a.ui.loxiabutton.getter="";a.ui.loxiabutton.defaults={type:"button",data:{}}})(jQuery);(function(c){var a=c.extend({},loxia.loxiaWidget,{getBaseClass:function(){return"loxiainput"},_initInput:function(){this._setData("checkmaster",this.element.attr("checkmaster")||"");this.element.focus(function(){if(c(this).is(".ui-state-disabled")||c(this).attr("readonly")){return}var f=c(this).data("loxiainput"),e=c(this).data("loxiatooltip");c(this).addClass("ui-state-active");if(f._getData("errorMessage")){e.show(f._getData("errorMessage"))}if(f._getData("select")){c(this).select()}});this.element.blur(function(){if(c(this).is(".ui-state-disabled")||c(this).attr("readonly")){return}var g=c(this).data("loxiainput"),f=c(this).data("loxiatooltip");c(this).removeClass("ui-state-active");f.hide();var e=c(this).val();if(c(this).attr("trim")=="true"){e=c.trim(e);c(this).val(e)}g.val(e)})},_init:function(){if(this.element.is("input")||this.element.is("textarea")){this.element.removeAttr("loxiaType");var e=this.getBaseClass();this._setData("baseClass",e);this.element.data("baseClass",e);this.element.addClass("loxia ui-"+e+" ui-state-default ui-corner-all");if(this.element.attr("required")=="true"||this.element.attr("required")==true){this._setData("required",true);this.element.addClass("ui-state-mandatory")}if(this.element.attr("disabled")){this.setEnable(false)}if(this.element.attr("selectonfocus")=="true"||this.element.attr("selectonfocus")==true){this._setData("select",true)}if(this.element.val()!=null){this._setData("lastRightValue",this.element.val())}this.element.loxiatooltip();this._initInput();if(this.element.attr("readonly")){this.setReadonly(true)}}else{throw new Error("Wrong Dom Type for Input")}}});c.widget("ui.loxiainput",a);c.ui.loxiainput.getter=loxia.loxiaGetter;c.ui.loxiainput.defaults=loxia.defaults;var b=c.extend({},a,{getBaseClass:function(){return"loxianumber"},_initInput:function(){this.element.css({"text-align":"right"});var f="checkNumber";if(this.element.attr("checkmaster")){f+=(","+this.element.attr("checkmaster"))}this._setData("checkmaster",f);var g=["decimal","min","max"];for(var e,h=0;e=g[h];h++){if(this.element.attr(e)){var j=parseInt(this.element.attr(e),10);if(!isNaN(j)){this._setData(e,j)}}}this.element.focus(function(){if(c(this).is(".ui-state-disabled")||c(this).attr("readonly")){return}var k=c(this).data("loxianumber"),i=c(this).data("loxiatooltip");c(this).addClass("ui-state-active");if(k._getData("errorMessage")){i.show(k._getData("errorMessage"))}if(k._getData("select")){c(this).select()}});this.element.blur(function(){if(c(this).is(".ui-state-disabled")||c(this).attr("readonly")){return}var l=c(this).data("loxianumber"),k=c(this).data("loxiatooltip");c(this).removeClass("ui-state-active");k.hide();var i=c(this).val();if(c(this).attr("trim")=="true"){i=c.trim(i);c(this).val(i)}l.val(i)})}});c.widget("ui.loxianumber",b);c.ui.loxianumber.getter=loxia.loxiaGetter;c.ui.loxianumber.defaults=loxia.defaults;var d=c.extend({},a,{getBaseClass:function(){return"loxiadate"},setReadonly:function(e){if(e){this.element.attr("readonly","readonly");this.element.datepicker("disable")}else{this.element.removeAttr("readonly");this.element.datepicker("enable")}},_initInput:function(){var f="checkDate";if(this.element.attr("checkmaster")){f+=(","+this.element.attr("checkmaster"))}this._setData("checkmaster",f);this.element.data("dropdown",true);var h,j;try{if(this.element.attr("min")){if(this.element.attr("min")=="today"){h=new Date()}else{h=c.datepicker.parseDate(loxia.dateFormat,this.element.attr("min"))}this._setData("min",h)}}catch(i){}try{if(this.element.attr("max")){if(this.element.attr("max")=="today"){j=new Date()}else{j=c.datepicker.parseDate(loxia.dateFormat,this.element.attr("max"))}this._setData("max",j)}}catch(i){}var g={changeYear:true,changeMonth:true,dateFormat:loxia.dateFormat,onSelect:function(l,k){var e=c(this).data("loxiadate");e.val(l)}};if(h){g.minDate=h}if(j){g.maxDate=j}this.element.datepicker(g);this.element.focus(function(){if(c(this).is(".ui-state-disabled")||c(this).attr("readonly")){return}var k=c(this).data("loxiadate"),e=c(this).data("loxiatooltip");c(this).addClass("ui-state-active");if(k._getData("errorMessage")){e.show(k._getData("errorMessage"))}if(k._getData("select")){c(this).select()}});this.element.blur(function(){if(c(this).is(".ui-state-disabled")||c(this).attr("readonly")){return}var l=c(this).data("loxiadate"),k=c(this).data("loxiatooltip");c(this).removeClass("ui-state-active");k.hide();var e=c(this).val();if(c(this).attr("trim")=="true"){e=c.trim(e);c(this).val(e)}l.val(e)})}});c.widget("ui.loxiadate",d);c.ui.loxiadate.getter=loxia.loxiaGetter;c.ui.loxiadate.defaults=loxia.defaults})(jQuery);(function(b){var a=b.extend({},loxia.loxiaWidget,{getBaseClass:function(){return"loxiaselect"},_initSelect:function(){this._setData("checkmaster",this.element.attr("checkmaster")||"");this.element.focus(function(){if(b(this).is(".ui-state-disabled")){return}var d=b(this).data("loxiaselect"),c=b(this).data("loxiatooltip");b(this).addClass("ui-state-active");if(d._getData("errorMessage")){c.show(d._getData("errorMessage"))}});this.element.blur(function(){if(b(this).is(".ui-state-disabled")){return}var c=b(this).data("loxiatooltip");b(this).removeClass("ui-state-active");c.hide()});this.element.change(function(){var e=b(this).data("loxiaselect"),d=b(this).data("loxiatooltip");b(this).removeClass("ui-state-active");d.hide();var c=b(this).val();e.val(c)})},_init:function(){if(this.element.is("select")){this.element.removeAttr("loxiaType");var c=this.getBaseClass();this.element.data("baseClass",c);this._setData("baseClass",c);this.element.addClass("loxia ui-"+c+" ui-state-default ui-corner-all");if(this.element.attr("required")=="true"||this.element.attr("required")==true){this._setData("required",true);this.element.addClass("ui-state-mandatory")}if(this.element.attr("disabled")){this.setEnable(false)}if(this.element.attr("readonly")){this.setReadonly(true)}if(this.element.val()!=null){this._setData("lastRightValue",this.element.val())}this.element.loxiatooltip();this._initSelect()}else{throw new Error("Wrong Dom Type for Input")}}});b.widget("ui.loxiaselect",a);b.ui.loxiaselect.getter=loxia.loxiaGetter;b.ui.loxiaselect.defaults=loxia.defaults})(jQuery);(function(a){this.LoxiaChoice=function(c){this.data=c.data;this.findMode=c.findMode||"like";this.cachedKeys=[];this.cachedValues=[];this.currentList=[];this._isShown=false;var d='<div class="loxia ui-loxiachoice" style="position: absolute; left: 0; top: 0; z-index: 10000;"></div>';a("body").append(d);this.choiceContainer=a(".ui-loxiachoice:last");this.choiceContainer.hide();if(c.parentNode){this.parentNode=c.parentNode}this._initData();this._init()};this.LoxiaChoice.prototype.isShown=function(){return this._isShown};this.LoxiaChoice.prototype._initData=function(){if(this.data){if(a.isArray(this.data)){this.cachedValues=this.data;this.cachedKeys=null}else{for(k in this.data){this.cachedKeys.push(k);this.cachedValues.push(this.data[k])}}}};this.LoxiaChoice.prototype._init=function(){var c=this;a("li",this.choiceContainer).livequery(function(){a(this).hover(function(){a("li.ui-state-active",a(this).parent()).removeClass("ui-state-active");a(this).addClass("ui-state-active")},function(){});a(this).click(function(){c.hide();if(c.parentNode){c.parentNode.trigger("itemselected",[[a(this).attr("key"),a(this).text()]])}else{c.choiceContainer.trigger("itemselected",[[a(this).attr("key"),a(this).text()]])}})})};this.LoxiaChoice.prototype._match=function(e,c){var d=e.indexOf(c);if(d<0){return false}if(this.findMode=="like"){return true}if(this.findMode=="leftlike"&&d==0){return true}if(this.findMode=="rightlike"&&d==e.length-c.length){return true}return false};this.LoxiaChoice.prototype._filter=function(c){this.currentList=[];for(var d=0;d<this.cachedValues.length;d++){if(c==undefined||c==""||(c&&this._match(this.cachedValues[d],c))){this.currentList.push(d)}}};this.LoxiaChoice.prototype.moveTo=function(c){if(!this._isShown){return}a("li.ui-state-active",this.choiceContainer).removeClass("ui-state-active");if(c<0||c>=this.currentList.length){return}var d=this.cachedKeys==null?this.cachedValues[this.currentList[c]]:this.cachedKeys[this.currentList[c]];a("li[key='"+d+"']").addClass("ui-state-active")};this.LoxiaChoice.prototype.show=function(d){if(this.cachedValues.length==0){return}this._filter(d);if(this.currentList.length==0){if(this._isShown){this.hide()}return}var f='<ul class="ui-widget-content ui-corner-all" style="list-style:none; margin: 0; padding-left: 0;">';for(var j=0;j<this.currentList.length;j++){var m=this.cachedValues[this.currentList[j]],g=this.cachedKeys==null?m:this.cachedKeys[this.currentList[j]];f+='<li style="cursor: default; margin: 0; height: 20px; border 1px solid transparent; padding-left: 0;" key="'+g+'">'+m+"</li>"}f+="</ul>";this.choiceContainer.html(f);if(!this._isShown){this._isShown=true;var e=0,l=0,c=this.choiceContainer.width();if(this.parentNode){var h=this.parentNode.offset();e=h.left;l=h.top+this.parentNode.height()+2;c=c<this.parentNode.width()?this.parentNode.width():c}var n=this.choiceContainer.height();this.choiceContainer.css({left:e+"px",top:l+"px",height:0,width:c});this.choiceContainer.show();this.choiceContainer.animate({height:n},"fast")}if(d){this.moveTo(0)}};this.LoxiaChoice.prototype.hide=function(){this._isShown=false;this.choiceContainer.hide()};var b=a.extend({},loxia.loxiaWidget,{container:undefined,arrowNode:undefined,valueNode:undefined,loxiaChoice:undefined,_initDomNode:function(){var c=this.element.attr("name"),g=this.element.val(),f=this.element.attr("style"),e=this.element.width(),j='<input type="hidden" name="'+c+'"/>',i='<div style="overflow: hidden; -moz-box-sizing: content-box; display: inline-block; vertical-align: bottom; #display: inline; position: relative;',d='<div class="ui-state-default ui-corner-all" style="border: 0 solid; position: absolute; top: 2px; left:'+(e-16)+'px"><span class="ui-icon ui-icon-triangle-1-s"/></div>';if(!a.browser.msie){i+=f;this.element.attr("style","width: 99%;")}i+='"/>';this.element.before(i);this.container=a(this.element.prev());this.container.css(f);this.container.prepend(this.element.get(0));this.element.attr("name",c+"_mapped");this.element.after(j);this.valueNode=a(this.element.next());this.options.lastRightValue=g;this._setValue(this.element.val());this.container.append(d);this.arrowNode=this.container.find("div");var h=this;this.arrowNode.hover(function(){if(h.element.is(".ui-state-disabled")||h.element.attr("readonly")){return}a(this).addClass("ui-state-active")},function(){if(h.element.is(".ui-state-disabled")||h.element.attr("readonly")){return}a(this).removeClass("ui-state-active")})},_initEvent:function(){var c=this;this.arrowNode.click(function(){if(c.element.is(".ui-state-disabled")||c.element.attr("readonly")){return}var d=c.loxiaChoice;d.parentNode=c.element;if(d.isShown()){d.hide()}else{d.show();var e=c.val();a("li.ui-state-active",d.choiceContainer).removeClass("ui-state-active");a("li[key='"+e+"']",d.choiceContainer).addClass("ui-state-active")}});this.element.bind("itemselected",function(d,e){c.val(e[0])});this.element.focus(function(){if(a(this).is(".ui-state-disabled")||c.element.attr("readonly")){return}var d=a(this).data("loxiatooltip");a(this).addClass("ui-state-active");if(c._getData("errorMessage")){d.show(c._getData("errorMessage"))}if(c._getData("select")){a(this).select()}});this.element.blur(function(){if(a(this).is(".ui-state-disabled")||c.element.attr("readonly")){return}c.loxiaChoice.hide();var f=a(this).data("loxiatooltip");a(this).removeClass("ui-state-active");f.hide();var e=a(this).val(),d=0;for(;d<c.loxiaChoice.cachedValues.length;d++){if(c.loxiaChoice.cachedValues[d]==e){break}}d=d==c.loxiaChoice.cachedValues.length?-1:d;if(!c.editable&&d<0){c.setState(false,loxia.getLocaleMsg("INVALID_DATA"))}else{if(d>=0){e=c.loxiaChoice.cachedKeys==null?c.loxiaChoice.cachedValues[d]:c.loxiaChoice.cachedKeys[d];c.val(e)}else{c.val(e)}}});this.element.keyup(function(f){if(a(this).is(".ui-state-disabled")||c.element.attr("readonly")){return}var e=a("li.ui-state-active",c.loxiaChoice.choiceContainer);if(f.keyCode==40){if(e.get(0)){var d=e.next();if(d.get(0)){e.removeClass("ui-state-active");d.addClass("ui-state-active")}}else{c.loxiaChoice.moveTo(0)}}else{if(f.keyCode==38){if(e.get(0)){var g=e.prev();if(g.get(0)){e.removeClass("ui-state-active");g.addClass("ui-state-active")}}else{c.loxiaChoice.moveTo(c.loxiaChoice.currentList.length-1)}}else{if(f.keyCode==13){c.element.trigger("itemselected",[[e.attr("key"),e.text()]]);c.loxiaChoice.hide()}else{c.loxiaChoice.parentNode=c.element;c.loxiaChoice.show(a(this).val())}}}});a(document).mousedown(function(e){if(c.loxiaChoice.isShown()){var f=e.srcElement?e.srcElement:e.target;var d=a(f).is(".ui-loxiadropdown")?a(f):a(f).parents(".ui-loxiadropdown"),g=a(f).is(".ui-loxiachoice")?a(f):a(f).parents(".ui-loxiachoice");if(d.length==0&&g.length==0){c.loxiaChoice.hide()}}})},_setValue:function(d){this.valueNode.val(d);var c=this._findValue(d);c=c||d;return this.element.val(c)},_findValue:function(c){if(a.isArray(this.options.data)){return c}return this.options.data[c]},_getValue:function(){return this.valueNode.val()},_init:function(){if(!this.element.is("input")){throw new Error("Wrong Dom Type for Dropdown")}if(this.options.editable==true&&!a.isArray(this.options.data)){throw new Error("Wrong data for editable dropdown")}if(this.options.choice){if(loxia.isString(this.options.choice)){this.loxiaChoice=document[this.options.choice]}else{this.loxiaChoice=this.options.choice}this.options.data=this.loxiaChoice.data}else{this.loxiaChoice=new LoxiaChoice({findMode:this.options.findMode,data:this.options.data})}this._initDomNode();var c="loxiadropdown";this._setData("baseClass",c);this.element.data("baseClass",c);this.element.addClass("loxia ui-"+c+" ui-state-default ui-corner-all");if(this.element.attr("required")=="true"){this._setData("required",true);this.element.addClass("ui-state-mandatory")}if(this.element.attr("disabled")){this.setEnable(false)}if(this.element.attr("readonly")){this.setReadonly(true)}if(this.element.attr("selectonfocus")=="true"){this._setData("select",true)}this.element.loxiatooltip();this._initEvent()},_setValue:function(d){this.valueNode.val(d);var c=this._findValue(d);if(!c&&!this.options.editable){this.valueNode.val("")}c=c||d;return this.element.val(c)},setEnable:function(c){if(c){this.element.removeClass("ui-state-disabled");this.element.removeAttr("disabled");this.arrowNode.removeClass("ui-state-disabled")}else{this.element.addClass("ui-state-disabled");this.element.attr("disabled","disabled");this.arrowNode.addClass("ui-state-disabled")}}});a.widget("ui.loxiadropdown",b);a.ui.loxiadropdown.getter="";a.ui.loxiadropdown.defaults=a.extend({},loxia.defaults,{editable:false,findMode:"like"})})(jQuery);(function(a){var c=this;var b=a.extend({},a.ui.dialog.prototype,{_createButtons:function(m){var o=this,g=false,f=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");this.uiDialog.find(".ui-dialog-buttonpane").remove();var j="",d={};for(var h=0,n;n=m[h];h++){if(loxia.isString(n)){j+=n}else{var l=n.buttonType||"button";j+='<button loxiaType="button" buttonType="'+l+'"';if(n.id){j+=' id = "'+n.id+'"'}if(n.target){j+=' target="'+n.target+'"'}if(n.href){j+=' href="'+n.href+'"'}if(n.disabled){j+=' disabled="disabled"'}if(n.func){d[""+h]=loxia.isString(n.func)?c[n.func]:n.func}j+=">"+n.value+"</button>"}}f.append(j);f.appendTo(this.uiDialog);loxia.initContext(f.get(0));for(var e in d){f.find("button:eq("+e+")").bind("click",d[e])}}});a.widget("ui.loxiadialog",b);a.extend(a.ui.loxiadialog,{version:"1.1",defaults:{autoOpen:true,bgiframe:false,buttons:[],closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:"center",resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},getter:"isOpen",uuid:0,maxZ:0,getTitleId:function(d){return"ui-dialog-title-"+(d.attr("id")||++this.uuid)},overlay:function(d){this.$el=a.ui.loxiadialog.overlay.create(d)}});a.extend(a.ui.loxiadialog.overlay,{instances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(d){return d+".dialog-overlay"}).join(" "),create:function(e){if(this.instances.length===0){setTimeout(function(){if(a.ui.dialog.overlay.instances.length){a(document).bind(a.ui.dialog.overlay.events,function(f){var g=a(f.target).parents(".ui-dialog").css("zIndex")||0;return(g>a.ui.dialog.overlay.maxZ)})}},1);a(document).bind("keydown.dialog-overlay",function(f){(e.options.closeOnEscape&&f.keyCode&&f.keyCode==a.ui.keyCode.ESCAPE&&e.close(f))});a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize)}var d=a("<div></div>").appendTo(document.body).addClass("ui-widget-overlay").css({width:this.width(),height:this.height()});(e.options.bgiframe&&a.fn.bgiframe&&d.bgiframe());this.instances.push(d);return d},destroy:function(d){this.instances.splice(a.inArray(this.instances,d),1);if(this.instances.length===0){a([document,window]).unbind(".dialog-overlay")}d.remove();var e=0;a.each(this.instances,function(){e=Math.max(e,this.css("z-index"))});this.maxZ=e},height:function(){if(a.browser.msie&&a.browser.version<7){var e=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);var d=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(e<d){return a(window).height()+"px"}else{return e+"px"}}else{return a(document).height()+"px"}},width:function(){if(a.browser.msie&&a.browser.version<7){var d=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);var e=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(d<e){return a(window).width()+"px"}else{return d+"px"}}else{return a(document).width()+"px"}},resize:function(){var d=a([]);a.each(a.ui.dialog.overlay.instances,function(){d=d.add(this)});d.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}});a.extend(a.ui.loxiadialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);(function($){var loxiaRowIndex=0;var loxiaBaseTable={_formatName:function(str){return str.replace(/\./ig,"_")}};var loxiaBaseTableDefaults={};var loxiaTable=$.extend({},loxiaBaseTable,{_initSelector:function(){var $t=this.element,selectors=[],selected=this._getData("selected");var sels=0;$t.find("thead tr:last th").each(function(){var s="",chkbox=$(this).find("input[type='checkbox']"),radbox=$(this).find("input[type='radio']"),name=$(this).attr("name")||$(this).attr("property");if(chkbox.get(0)){s="+"+name}else{if(radbox.get(0)){radbox.replaceWith("&nbsp;");s="-"+name}}selectors.push(s);if(s){sels++;selected["col_"+(selectors.length-1)]=$.extend({},selected["col_"+(selectors.length-1)]);$(this).addClass("selector")}});this._setData("selectCols",sels);this._setData("selectors",selectors)},_loadData:function(reloadAll){var $t=this.element;var $tbody=$t.find("tbody:first"),propList=[];$t.find("thead tr:last th").each(function(){propList.push($(this).attr("property"))});var selectors=this._getData("selectors"),selectCache=this._getData("selected");var data=this._getData("data");if(data&&data.length&&data.length>0){var rowlist="";for(var dataItem,i=0;(dataItem=data[i]);i++){var row="<tr>";for(var p,j=0;p=propList[j];j++){var value=loxia.getObject(p,dataItem);if(selectors[j]){var selected=selectCache["col_"+j];value=(value==undefined||value==null||(loxia.isString(value)&&!value))?"":""+value;value=this._formatName(value);var strSelected=(value in selected)?" checked":"";var name=selectors[j].substring(1);if(selectors[j].charAt(0)=="+"){row+="<td><input type='checkbox'"+strSelected+" name='"+name+"' value='"+value+"'/></td>"}else{if(selectors[j].charAt(0)=="-"){row+="<td><input type='radio'"+strSelected+" name='"+name+"' value='"+value+"'/></td>"}else{throw new Error("Load Data for Selector Error.")}}}else{value=(value==undefined||value==null||(loxia.isString(value)&&!value))?"&nbsp;":value;row+="<td>"+value+"</td>"}}row+="</tr>";rowlist+=row}if(reloadAll){$tbody.html(rowlist)}else{$tbody.append(rowlist)}}$t.trigger("dataloaded",[data])},_initStyle:function(){var $t=this.element,sortStatus=[],currentSort=this._getData("sort");if(currentSort){var sortlist=currentSort.split(",");sortStatus.push(sortlist[0]);sortStatus.push(sortlist[1]||"asc")}$t.find("thead tr").each(function(i){$(this).addClass("ui-widget-header");$(this).find("th").addClass("ui-state-default")});$t.find("tbody:gt(0)").addClass("ui-widget-content");var cols=$t.find("thead tr:last th").each(function(i){var sortClass="",sort=$(this).attr("sort");if(sort){sortClass="sort-nosort";if(sort==sortStatus[0]){if(sortStatus[1].toLowerCase()=="asc"){sortClass="sort-asc"}else{if(sortStatus[1].toLowerCase()=="desc"){sortClass="sort-desc"}}}}var className=$(this).hasClass("selector")?"selector":"";$(this).addClass(sortClass).addClass("col-"+i);$(this).html("<div class='th-col-"+i+"'>"+$(this).html()+"<div class='ui-sort'></div></div>");$t.find("tbody:first tr").find("td:eq("+i+")").addClass(className+" col-"+i)}).length;this._setData("cols",cols);$t.find("tbody:first tr:odd").addClass("odd");$t.find("tbody:first tr:even").addClass("even");$t.find("tbody").find("tr:last").addClass("last");if(this._getData("selectCols")==1){$t.find("tbody:first input:checked").parents("tr").addClass("selected")}return this},_initHeadAction:function(){var $t=this.element;var _this=this;$("thead tr:last th",$t).livequery(function(){$(this).hover(function(){$(this).toggleClass("ui-state-hover")},function(){$(this).toggleClass("ui-state-hover")});$(this).click(function(){var $th=$(this);var sort=$th.attr("sort");if(!sort){return}var sortStr=""+sort+",",sortOrder="";if($th.hasClass("sort-asc")){sortOrder="desc"}else{sortOrder="asc"}sortStr+=sortOrder;var args={data:{currentPage:_this._getData("currentPage"),pageSize:_this._getData("pageSize"),sortString:sortStr}};if(_this._getData("form")){args.form=_this._getData("form")}_this._refresh(args)})})},_refresh:function(args){var _this=this;var $t=this.element;var $reload=$t.find('.ui-pager-block[block="refresh"]');$reload.find(".ui-state-default").addClass("loading");if(!this.options.cacheSelect){var selected=this.options.selected;for(key in selected){selected[key]={}}}args=$.extend({error:function(XMLHttpRequest,textStatus,errorThrown){var exception={};exception.message="Error occurs when fetching data from url:"+this.url;exception.cause=textStatus?textStatus:errorThrown;$t.find(".ui-pager-status > div").addClass("ui-state-highlight").text(loxia.getLocaleMsg("TABLE_PAGE_ERROR_OCCURS")).show().animate({opacity:1},"fast");$reload.find(".loading").removeClass("loading")}},args);var url=args.url||this.options.url;loxia.asyncXhr(url,args,function(data,textStatus){if(data.exception){$t.find(".ui-pager-status > div").addClass("ui-state-highlight").text(data.exception.message).show().animate({opacity:1},"fast")}else{_this.options.data=data;_this.refresh(true);if(data.sort){var sortStatus=[],sortlist=data.sort.split(",");sortStatus.push(sortlist[0]);sortStatus.push(sortlist[1]||"asc");$t.find("thead tr:last th").each(function(i){if(data.sort){$(this).removeClass("sort-asc sort-desc sort-nosort");var sort=$(this).attr("sort");if(sort){if(sort==sortStatus[0]){$(this).addClass("sort-"+sortStatus[1])}else{$(this).addClass("sort-nosort")}}}var className=$(this).hasClass("selector")?"selector":"";$t.find("tbody:first tr").find("td:eq("+i+")").addClass(className+" col-"+i)})}$t.find("tbody:first tr:odd").addClass("odd");$t.find("tbody:first tr:even").addClass("even");$t.find("tbody:first tr:last").addClass("last");if(_this.options.selectCols==1){$t.find("tbody:first input:checked").parents("tr").addClass("selected")}if(_this.options.page){_this._setPager()}$t.find(".ui-pager-status > div").removeClass("ui-state-highlight").text(loxia.getLocaleMsg("TABLE_PAGE_RELOAD")).show().animate({opacity:1},"fast")}$reload.find(".loading").removeClass("loading")})},_initPager:function(){var _this=this;var $t=this.element;if(!this._getData("page")||((!this.options.alwaysShowPage)&&this.options.pageCount<=1)){return}var pageSizeOptions=this._getData("pageSizeOptions");var pager='<div class="ui-pager"><div class="ui-pager-block" block="pagesize">'+loxia.getLocaleMsg("TABLE_PER_PAGE")+'<select loxiaType="select" formCheck="false">';for(var i=0;i<pageSizeOptions.length;i++){pager+='<option value="'+pageSizeOptions[i]+'">'+pageSizeOptions[i]+"</option>"}var itemStart=this.options.pageSize*(this.options.currentPage-1)+1;var itemEnd=itemStart+this.options.pageItemCount-1;pager+='</select></div><div class="ui-pager-block" block="navigator"><div class="separator"></div><div class="ui-state-default ui-corner-all"><span action="First" title="'+loxia.getLocaleMsg("TABLE_PAGER_FIRST")+'" class="ui-icon ui-icon-seek-first"></span></div> <div class="ui-state-default ui-corner-all"><span action="Previous" title="'+loxia.getLocaleMsg("TABLE_PAGER_PREVIOUS")+'" class="ui-icon ui-icon-seek-prev"></span></div> <div class="ui-state-default ui-corner-all"><span action="Next" title="'+loxia.getLocaleMsg("TABLE_PAGER_NEXT")+'" class="ui-icon ui-icon-seek-next"></span></div> <div class="ui-state-default ui-corner-all"><span action="Last" title="'+loxia.getLocaleMsg("TABLE_PAGER_LAST")+'" class="ui-icon ui-icon-seek-end"></span></div> <div class="separator"></div></div>';pager+='<div class="ui-pager-block" block="pagegoto"><div>'+loxia.getLocaleMsg("TABLE_PAGE")+' <input loxiaType="number" formCheck="false" min="1" max="'+this.options.pageCount+'" value="" style="width: 3em;"/>/<span"></span></div><div class="ui-state-default ui-corner-all"><span action="Goto" title="'+loxia.getLocaleMsg("TABLE_PAGER_GOTO")+'" class="ui-icon ui-icon-arrowreturnthick-1-w"></span></div></div>';pager+='<div class="ui-pager-block" block="refresh"><div class="separator"></div><div class="ui-state-default ui-corner-all"><span action="Reload" title="'+loxia.getLocaleMsg("TABLE_PAGER_RELOAD")+'" class="ui-icon ui-icon-transferthick-e-w"></span></div><div class="separator"></div><div class="page-info"><span></span></div></div>';pager+='<div class="ui-pager-status"><div class="ui-state-default ui-corner-all"></div></div>';pager+="</div>";var $tbody=$t.find("tbody:last").append('<tr class="last"><td colspan="'+this.options.cols+'">'+pager+"</td></tr>");$(".ui-pager .ui-state-default",$t).hover(function(){if(!$(this).hasClass("ui-state-disabled")&&!$(this).hasClass("loading")){$(this).addClass("ui-state-hover")}},function(){if(!$(this).hasClass("ui-state-disabled")&&!$(this).hasClass("loading")){$(this).removeClass("ui-state-hover")}});loxia.initContext($t.find("tbody:last tr:last"));this._setPager();$(".ui-pager",$t).livequery(function(){$(".ui-pager .ui-icon",$t).unbind("click").bind("click",function(){var $p=$(this).parent();if($p.hasClass("ui-state-disabled")||$p.hasClass("loading")){return false}if($p.hasClass("ui-state-hover")){$p.removeClass("ui-state-hover")}var action=$(this).attr("action");var moveto=true;var moveToPage=_this.options.currentPage;switch(action){case"Next":moveToPage+=1;break;case"Previous":moveToPage-=1;break;case"First":moveToPage=1;break;case"Last":moveToPage=$t.data("pageCount");break;case"Goto":var $input=$(".ui-pager-block[block='pagegoto'] input",$t);if($input.loxianumber("getState")==null){$input.loxianumber("check")}if($input.loxianumber("getState")){moveToPage=parseInt($input.loxianumber("val"))}else{moveto=false}}if(moveto){var settings={url:_this.options.url,data:{pageSize:_this.options.pageSize,currentPage:moveToPage}};if(_this.options.sort){settings.sort=_this.options.sort}if(_this.options.form){settings.form=_this.options.form}_this._refresh(settings)}});$(".ui-pager-block[block='pagesize'] select",$t).unbind("valuechanged").bind("valuechanged",function(){var pageSize=parseInt($(this).loxiaselect("val"));var settings={url:_this.options.url,data:{pageSize:pageSize,currentPage:1}};if(_this.options.sort){settings.sort=_this.options.sort}if(_this.options.form){settings.form=_this.options.form}_this._refresh(settings)})})},_setPager:function(){var $t=this.element;$(".ui-pager-block[block='pagesize'] select",$t).data("loxiaselect").val(""+this.options.pageSize);$(".ui-pager-block[block='pagegoto'] input",$t).data("loxianumber").val(""+this.options.currentPage);$(".ui-pager-block[block='pagegoto'] span").text(this.options.pageCount);$(".ui-pager-block .page-info span").text(loxia.getLocaleMsg("TABLE_PAGE_INFO",[this.options.itemCount]));var currentPage=this.options.currentPage;var pageCount=this.options.pageCount;$t.find(".ui-pager .ui-state-disabled").removeClass("ui-state-disabled");if(currentPage==1){$t.find(".ui-pager .ui-icon-seek-first").parent().addClass("ui-state-disabled");$t.find(".ui-pager .ui-icon-seek-prev").parent().addClass("ui-state-disabled")}if(currentPage>=pageCount){$t.find(".ui-pager .ui-icon-seek-next").parent().addClass("ui-state-disabled");$t.find(".ui-pager .ui-icon-seek-end").parent().addClass("ui-state-disabled")}$t.find(".ui-pager-status > div").hide().css({opacity:0})},_init:function(){this.element.removeAttr("loxiaType");this.element.addClass("loxia ui-loxia-table");this._initSelector();this._loadData(false);this._initStyle();this._initHeadAction();this._initPager();var _this=this;$("tbody:first .selector input",this.element).livequery(function(){$(this).click(function(){if(_this.options.selectCols==1){$(this).parents("tr").toggleClass("selected")}var selected=_this.options.selected["col_"+$(this).parents("td").get(0).cellIndex];var value=_this._formatName($(this).val());if($(this).is(":checked")){if($(this).is("input[type='radio']")){if(value in selected){delete selected[value];$(this).attr("checked",false)}else{for(key in selected){delete selected[key]}selected[value]=value}}else{selected[value]=value}}else{delete selected[value]}_this.element.trigger("selectchanged",[[$(this),selected]])})});$("thead .selector input",this.element).click(function(){var i=$(this).parents("th").get(0).cellIndex;var needStyle=(_this.options.selectCols==1),selected=_this.options.selected["col_"+i],checked=$(this).is(":checked");var changed=false;_this.element.find("tbody:first tr").find("td:eq("+i+") input").each(function(){var value=_this._formatName($(this).val());if($(this).is(":checked")!=checked){changed=true;$(this).attr("checked",checked);if(checked){selected[value]=value}else{delete selected[value]}if(needStyle){$(this).parents("tr").toggleClass("selected")}}});if(changed){_this.element.trigger("selectchanged",[[$(this),selected]])}})}});$.widget("ui.loxiatable",loxiaTable);$.ui.loxiatable.getter="";$.ui.loxiatable.defaults=$.extend({},loxiaBaseTableDefaults,{sort:"",page:false,alwaysShowPage:false,pageSize:20,pageSizeOptions:["10","15","20","25","30","40","50","100"],currentPage:1,pageCount:1,itemCount:0,pageItemCount:0,data:[],form:"",url:"",cacheSelect:false,selected:{}});var loxiaEditTable=$.extend({},loxiaBaseTable,{setAddable:function(flag){this.options.addable=flag;var $btn=this.element.find(".ui-bar .ui-icon[action='Add']").parent();$btn.removeClass("ui-state-disabled");if(!flag){$btn.addClass("ui-state-disabled")}},setDeletable:function(flag){this.options.deletable=flag;var $btn=this.element.find(".ui-bar .ui-icon[action='Delete']").parent();$btn.removeClass("ui-state-disabled");if(!flag){$btn.addClass("ui-state-disabled")}},_initExecBar:function(){var $t=this.element;var bar='<div class="ui-bar">';bar+='<div class="ui-bar-block" block="operator"><div class="separator"></div><div class="ui-state-default ui-corner-all'+(this.options.addable?"":" ui-state-disabled")+'"><span action="Add" title="'+loxia.getLocaleMsg("TABLE_BARBTN_ADD")+'" class="ui-icon ui-icon-plusthick"></span></div> <div class="ui-state-default ui-corner-all'+(this.options.deletable?"":" ui-state-disabled")+'"><span action="Delete" title="'+loxia.getLocaleMsg("TABLE_BARBTN_DELETE")+'" class="ui-icon ui-icon-minusthick"></span></div> <div class="separator"></div></div>';bar+="</div>";var $tbody=$t.find("tbody:last").append('<tr class="last"><td colspan="'+this.options.cols+'">'+bar+"</td></tr>");var _this=this;$(".ui-bar .ui-state-default",$t).hover(function(){if(!$(this).hasClass("ui-state-disabled")){$(this).addClass("ui-state-hover")}},function(){if(!$(this).hasClass("ui-state-disabled")){$(this).removeClass("ui-state-hover")}});$(".ui-bar",$t).livequery(function(){$(".ui-bar .ui-icon",$t).unbind("click").bind("click",function(){var $p=$(this).parent();if($p.hasClass("ui-state-disabled")){return false}switch($(this).attr("action")){case"Add":_this.appendRow();break;case"Delete":_this.deleteRow();break}_this._calculateFoot();$t.find("tbody:first tr:odd").removeClass("even").addClass("odd");$t.find("tbody:first tr:even").removeClass("odd").addClass("even")})})},_init:function(){this.element.removeAttr("loxiaType");this.element.addClass("loxia ui-loxia-table");var _this=this;var $t=this.element;if($("tbody",$t).length!=2){throw new Error("Current table need at least and only 2 tbodies.")}$t.find("thead tr").each(function(i){$(this).addClass("ui-widget-header");$(this).find("th").addClass("ui-state-default")});$t.find("tbody:gt(0)").addClass("ui-widget-content");var formulas=[];var cols=$t.find("thead tr:last th").each(function(i){$(this).html("<div class='th-col-"+i+"'>"+$(this).html()+"</div>");$t.find("tbody tr").find("td:eq("+i+")").addClass(" col-"+i);var formula=$(this).attr("formula")||"";formulas.push(formula);$(this).hover(function(){$(this).toggleClass("ui-state-hover")},function(){$(this).toggleClass("ui-state-hover")})}).length;this.options.cols=cols;$t.find("tfoot tr").each(function(){var index=0;$(this).find("td").each(function(){var colspan=parseInt($(this).attr("colspan")||"1");$(this).addClass("col-"+index);$(this).data("col",index);index+=colspan})});$t.find("tfoot tr:last").addClass("last");this.options.formulas=formulas;$t.find("tbody .col-0 input[type='checkbox']").each(function(){$(this).parents("td").addClass("selector")});var $tptTbody=$("tbody:last",$t);var templateStr=$tptTbody.html();this.options.template=templateStr;$("tr",$tptTbody).remove();loxia.initContext($t.find("tbody:first"));for(var i=0;i<this.options.append;i++){this.appendRow()}this._calculateRow();this._calculateFoot();$t.find("tbody:first tr:odd").removeClass("even").addClass("odd");$t.find("tbody:first tr:even").removeClass("odd").addClass("even");this._initExecBar();$("thead tr:last",$t).find(".th-col-0 input[type='checkbox']").bind("click",function(){if($(this).is(":checked")){$("tbody:first .col-0 input[checked='false']",$t).each(function(){$(this).attr("checked",true);$(this).parents("tr").addClass("selected")})}else{$("tbody:first .col-0 input:checked",$t).each(function(){$(this).attr("checked",false);$(this).parents("tr").removeClass("selected")})}});$("tbody:first tr",$t).livequery(function(){var $tr=$(this);$("input,select,textarea",$tr).each(function(){if($(this).parents("td").is(".selector")){$(this).unbind("click").bind("click",function(){$tr.removeClass("select");if($(this).is(":checked")){$tr.addClass("selected")}else{$tr.removeClass("selected")}})}else{if(loxia.isLoxiaWidget(this)){$(this).unbind("valuechanged").bind("valuechanged",function(event,data){$t.trigger("rowchanged",[[$tr.get(0),this]])})}else{if($(this).is("select")){$(this).unbind("change").bind("change",function(event,data){$t.trigger("rowchanged",[[$tr.get(0),this]])})}else{$(this).unbind("blur").bind("blur",function(event,data){$t.trigger("rowchanged",[[$tr.get(0),this]])})}}}})});$t.bind("rowchanged",function(event,data){var row=data[0];if(row){_this._calculateRow(row)}_this._calculateFoot()})},appendRow:function(){var $t=this.element,rowIndex=""+(--loxiaRowIndex),row=this.options.template.replace(/\(#\)/ig,"("+rowIndex+")");$t.find("tbody:first").append(row);loxia.initContext($t.find("tbody:first tr:last"));$t.trigger("rowappended",[$t.find("tbody:first tr:last")])},deleteRow:function(){var $t=this.element;if($("tbody:first .col-0 :checked",$t).length>0){$t.find("tbody:first tr:has(.col-0 input:checked)").remove();$t.trigger("rowdeleted")}},_calculateRow:function(context){var $t=$(this);context=context||$t.find("tbody:first");var $rows=$(context);if(!$rows.is("tr")){$rows=$rows.find("tr")}var calCols=[],formulas=this.options.formulas;for(var i=0;i<this.options.cols;i++){if(formulas[i]){calCols.push(i)}}if(calCols.length>0){for(var i=0;i<calCols.length;i++){var formula=formulas[calCols[i]],decimal=0;var delim=formula.indexOf(":");if(delim>0){decimal=parseInt(formula.substring(delim+1));formula=formula.substring(0,delim)}var params=formula.match(/\$\d+/ig);formula=formula.replace(/\$\d+/ig,"#");$rows.each(function(){var f=""+formula;for(var j=0;j<params.length;j++){var cellIndex=parseInt(params[j].replace(/\$/,""));var p=loxia.val($(this).find("td:eq("+cellIndex+")").get(0));p=(p==null||$.trim(p)=="")?0:p;f=f.replace(/\#/,p)}var value=eval(f);value=value?value.toFixed(decimal):"";$(this).find("td:eq("+calCols[i]+")").text(value)})}}},_calculateFoot:function(){var $t=this.element;$t.find("tfoot td[decimal]").each(function(){var decimal=parseInt($(this).attr("decimal")),result=0;$t.find("tbody:first tr").find("td:eq("+$(this).data("col")+")").each(function(){var value=parseFloat(loxia.val($(this).get(0)));value=isNaN(value)?0:value;result+=value==null?0:value});$(this).text(result.toFixed(decimal))});$t.trigger("calculated")}});$.widget("ui.loxiaedittable",loxiaEditTable);$.ui.loxiaedittable.getter="";$.ui.loxiaedittable.defaults=$.extend({},loxiaBaseTableDefaults,{addable:true,deletable:true,append:0})})(jQuery);