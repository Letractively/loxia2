<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:sec="http://www.springframework.org/schema/security"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd">
	<sec:http entry-point-ref="authenticationEntryPoint">		
		<sec:intercept-url pattern="/login" filters="none"/>
		<sec:intercept-url pattern="/accessdenied" filters="none"/>
		<sec:intercept-url pattern="/commons/**" filters="none"/>
		<sec:intercept-url pattern="/css/**" filters="none"/>
		<sec:intercept-url pattern="/images/**" filters="none"/>
		<sec:intercept-url pattern="/scripts/**" filters="none"/>
		<sec:intercept-url pattern="/**" access="IS_AUTHENTICATED_FULLY"/>			
		<sec:anonymous/>
	</sec:http>		
  	
  	<bean id="authenticationProcessingFilter"
	    class="org.springframework.security.ui.webapp.AuthenticationProcessingFilter">
	  <sec:custom-filter position="AUTHENTICATION_PROCESSING_FILTER"/>
	  <property name="authenticationManager" ref="authenticationManager"/>
	  <property name="authenticationFailureUrl" value="/accessdenied"/>
	  <property name="defaultTargetUrl" value="/desktop"/>
	  <property name="filterProcessesUrl" value="/j_spring_security_check"/>
	  <property name="exceptionMappings">
	    <props>
	      <prop key="org.springframework.security.BadCredentialsException">/login?error=true</prop>
	    </props>
	  </property>
	</bean>
	
	<bean id="authenticationEntryPoint"
        class="cn.benjamin.loxia.security.LoxiaAjaxAwareFormAuthenticationEntryPoint">
        <property name="loginFormUrl" value="/login"/>
    </bean>
	
  	<sec:authentication-manager alias="authenticationManager"/>      
  	
  	<sec:authentication-provider user-service-ref="userDetailsService"/>

	<!-- This bean is optional; it isn't used by any other bean as it only listens and logs -->
	<bean class="org.springframework.security.event.authentication.LoggerListener" />
</beans>